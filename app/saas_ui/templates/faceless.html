{% extends "base.html" %}

{% block title %}Faceless AI –°—Ç—É–¥–∏—è{% endblock %}

{% block head %}
<style>
    /* Progress ring */
    .progress-ring {
        transform: rotate(-90deg);
    }
    .progress-ring circle {
        stroke-dasharray: 314;
        stroke-dashoffset: 314;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.5s ease;
    }

    /* Step indicators */
    .step-dot {
        transition: all 0.3s ease;
    }
    .step-dot.active { background: #a855f7; transform: scale(1.2); }
    .step-dot.completed { background: #22c55e; }

    /* Job card */
    .job-card {
        transition: all 0.2s;
    }
    .job-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    /* Script segment */
    .segment-card {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.05), rgba(99, 102, 241, 0.05));
        border: 1px solid rgba(168, 85, 247, 0.1);
    }

    /* Subtitle preview */
    .subtitle-demo {
        font-family: 'Montserrat', sans-serif;
        font-weight: 900;
        text-shadow: -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000, 3px 3px 0 #000;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="h-full flex flex-col" id="faceless-app">
    <!-- Header -->
    <header class="h-14 glass border-b border-white/5 flex items-center justify-between px-6 flex-shrink-0">
        <div class="flex items-center gap-4">
            <a href="/app" class="flex items-center gap-2 text-dark-400 hover:text-white transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </a>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-brand-500 to-indigo-600 rounded-xl flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white">Faceless AI –°—Ç—É–¥–∏—è</h1>
                    <p class="text-xs text-dark-400">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ</p>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-sm text-dark-400">{{ credits }} –∫—Ä–µ–¥–∏—Ç–æ–≤</span>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex overflow-hidden">
        <!-- Left: Generator Form -->
        <div class="w-1/2 p-8 overflow-y-auto scrollbar-thin border-r border-white/5">
            <div class="max-w-lg mx-auto">
                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <!-- –ë–õ–û–ö 1: –ö–û–ù–¢–ï–ù–¢ -->
                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div id="step-topic" class="space-y-6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                            <span class="text-white text-lg">üìù</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-white">–ö–æ–Ω—Ç–µ–Ω—Ç</h2>
                            <p class="text-xs text-dark-400">–¢–µ–º–∞, —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ —Å—Ç–∏–ª—å</p>
                        </div>
                    </div>

                    <!-- –¢–µ–º–∞ –≤–∏–¥–µ–æ -->
                    <div>
                        <label class="block text-sm font-medium text-dark-300 mb-2">–¢–µ–º–∞ –≤–∏–¥–µ–æ</label>
                        <input type="text" id="topic" placeholder="5 –ª–∞–π—Ñ—Ö–∞–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—Ç –≤–∞—à–µ —É—Ç—Ä–æ"
                               class="w-full px-4 py-4 bg-dark-800/50 border border-white/10 rounded-xl text-white placeholder-dark-500 focus:outline-none focus:border-brand-500 text-lg">
                        <p class="text-xs text-dark-500 mt-2">–ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã ‚Äî –ò–ò —Å–æ–∑–¥–∞—Å—Ç –≤–∏—Ä–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π —Ç–µ–º—ã</p>
                    </div>

                    <!-- –°–≤–æ—è –∏–¥–µ—è / —á–µ—Ä–Ω–æ–≤–∏–∫ -->
                    <div class="bg-dark-800/30 rounded-xl p-4 border border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <label class="text-sm font-medium text-dark-300 flex items-center gap-2">
                                <span>‚ú®</span> –°–≤–æ—è –∏–¥–µ—è / —á–µ—Ä–Ω–æ–≤–∏–∫
                                <span class="text-[10px] text-dark-500 bg-dark-700 px-2 py-0.5 rounded">–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ</span>
                            </label>
                            <button type="button" onclick="Faceless.toggleCustomIdea()" class="text-xs text-brand-400 hover:text-brand-300 flex items-center gap-1">
                                <span id="toggle-idea-text">–î–æ–±–∞–≤–∏—Ç—å</span>
                                <svg id="toggle-idea-icon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="custom-idea-section" class="hidden space-y-4">
                            <textarea id="custom_idea" rows="4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –∏–¥–µ—é –∏–ª–∏ —á–µ—Ä–Ω–æ–≤–∏–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è. –ò–ò –¥–æ—Ä–∞–±–æ—Ç–∞–µ—Ç –µ–≥–æ, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –≤–∞—à—É —Å—É—Ç—å..."
                                      class="w-full px-4 py-3 bg-dark-900/50 border border-white/10 rounded-xl text-white placeholder-dark-500 focus:outline-none focus:border-brand-500 text-sm resize-none"></textarea>

                            <!-- –†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ - –∫—Ä–∞—Å–∏–≤—ã–µ –∫–Ω–æ–ø–∫–∏ -->
                            <div>
                                <label class="block text-xs text-dark-400 mb-2">–†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <button type="button" class="idea-mode-btn p-3 bg-dark-900/50 rounded-xl border-2 border-brand-500 bg-brand-500/10 text-center transition-all" data-mode="expand" onclick="Faceless.setIdeaMode('expand')">
                                        <span class="text-lg mb-1 block">üöÄ</span>
                                        <span class="text-xs font-medium text-white block">–†–∞–∑–≤–∏—Ç—å</span>
                                        <span class="text-[10px] text-dark-400 block mt-1">–ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π</span>
                                    </button>
                                    <button type="button" class="idea-mode-btn p-3 bg-dark-900/50 rounded-xl border-2 border-white/10 text-center transition-all hover:border-brand-400" data-mode="polish" onclick="Faceless.setIdeaMode('polish')">
                                        <span class="text-lg mb-1 block">‚ú®</span>
                                        <span class="text-xs font-medium text-white block">–£–ª—É—á—à–∏—Ç—å</span>
                                        <span class="text-[10px] text-dark-400 block mt-1">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—Ç—å</span>
                                    </button>
                                    <button type="button" class="idea-mode-btn p-3 bg-dark-900/50 rounded-xl border-2 border-white/10 text-center transition-all hover:border-brand-400" data-mode="strict" onclick="Faceless.setIdeaMode('strict')">
                                        <span class="text-lg mb-1 block">üìù</span>
                                        <span class="text-xs font-medium text-white block">–ö–∞–∫ –µ—Å—Ç—å</span>
                                        <span class="text-[10px] text-dark-400 block mt-1">–¢–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç</span>
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" id="idea_mode" value="expand">
                        </div>
                    </div>

                    <!-- –°—Ç–∏–ª—å –∏ –Ø–∑—ã–∫ -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-dark-300 mb-2">–°—Ç–∏–ª—å —Å—Ü–µ–Ω–∞—Ä–∏—è</label>
                            <select id="style" class="w-full px-4 py-3 bg-dark-800/50 border border-white/10 rounded-xl text-white focus:outline-none focus:border-brand-500">
                                <option value="viral">üî• –í–∏—Ä–∞–ª—å–Ω—ã–π</option>
                                <option value="educational">üìö –û–±—É—á–∞—é—â–∏–π</option>
                                <option value="storytelling">üìñ –°—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥</option>
                                <option value="motivational">üí™ –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π</option>
                                <option value="documentary">üé¨ –î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-dark-300 mb-2">–Ø–∑—ã–∫</label>
                            <select id="language" class="w-full px-4 py-3 bg-dark-800/50 border border-white/10 rounded-xl text-white focus:outline-none focus:border-brand-500">
                                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                <option value="en">üá∫üá∏ English</option>
                            </select>
                        </div>
                    </div>

                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- –ë–õ–û–ö 2: –í–ò–ó–£–ê–õ -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-6"></div>

                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-500 rounded-xl flex items-center justify-center">
                            <span class="text-white text-lg">üé®</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-white">–í–∏–∑—É–∞–ª</h2>
                            <p class="text-xs text-dark-400">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä, —Å—Ç–∏–ª—å –∏ —Ñ–æ—Ä–º–∞—Ç</p>
                        </div>
                    </div>

                    <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div>
                        <label class="block text-sm font-medium text-dark-300 mb-3">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</label>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="p-4 bg-dark-800/50 rounded-xl border-2 border-brand-500 bg-brand-500/10 text-left">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                        <span class="text-white text-sm font-bold">K</span>
                                    </div>
                                    <div>
                                        <span class="text-sm text-white font-medium block">Kie.ai (Nano Banana)</span>
                                        <span class="text-[10px] text-dark-500">Gemini 2.5 Flash</span>
                                    </div>
                                </div>
                                <p class="text-[10px] text-dark-400">–ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</p>
                            </div>
                        </div>
                    </div>

                    <!-- Video Format -->
                    <div>
                        <label class="block text-sm font-medium text-dark-300 mb-3">–§–æ—Ä–º–∞—Ç –≤–∏–¥–µ–æ</label>
                        <div class="grid grid-cols-3 gap-3">
                            <button class="format-btn px-4 py-6 bg-dark-800/50 rounded-xl border-2 border-brand-500 bg-brand-500/10 flex flex-col items-center gap-2" data-format="9:16">
                                <div class="w-6 h-10 border-2 border-brand-400 rounded"></div>
                                <span class="text-sm text-white font-medium">9:16</span>
                                <span class="text-[10px] text-dark-500">TikTok / Reels</span>
                            </button>
                            <button class="format-btn px-4 py-6 bg-dark-800/50 rounded-xl border-2 border-white/10 flex flex-col items-center gap-2" data-format="1:1">
                                <div class="w-8 h-8 border-2 border-dark-400 rounded"></div>
                                <span class="text-sm text-dark-300 font-medium">1:1</span>
                                <span class="text-[10px] text-dark-500">Instagram</span>
                            </button>
                            <button class="format-btn px-4 py-6 bg-dark-800/50 rounded-xl border-2 border-white/10 flex flex-col items-center gap-2" data-format="16:9">
                                <div class="w-10 h-6 border-2 border-dark-400 rounded"></div>
                                <span class="text-sm text-dark-300 font-medium">16:9</span>
                                <span class="text-[10px] text-dark-500">YouTube</span>
                            </button>
                        </div>
                    </div>

                    <!-- Subtitle Style -->
                    <div>
                        <label class="block text-sm font-medium text-dark-300 mb-3">–°—Ç–∏–ª—å —Å—É–±—Ç–∏—Ç—Ä–æ–≤</label>
                        <div class="space-y-2">
                            <button class="subtitle-btn w-full p-4 bg-dark-800/50 rounded-xl border-2 border-brand-500 bg-brand-500/10 text-left flex items-center justify-between" data-style="hormozi">
                                <div>
                                    <span class="text-sm text-white font-bold">–°—Ç–∏–ª—å Hormozi</span>
                                    <p class="text-xs text-dark-500">–ñ—ë–ª—Ç—ã–π —Ç–µ–∫—Å—Ç, —á—ë—Ä–Ω–∞—è –æ–±–≤–æ–¥–∫–∞, –∞–Ω–∏–º–∞—Ü–∏—è</p>
                                </div>
                                <span class="subtitle-demo text-yellow-400 text-lg">–ü–†–ò–ú–ï–†</span>
                            </button>
                            <button class="subtitle-btn w-full p-4 bg-dark-800/50 rounded-xl border-2 border-white/10 text-left flex items-center justify-between" data-style="clean">
                                <div>
                                    <span class="text-sm text-white font-medium">–ß–∏—Å—Ç—ã–π</span>
                                    <p class="text-xs text-dark-500">–ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç —Å —Ç–µ–Ω—å—é</p>
                                </div>
                                <span class="text-white text-lg shadow-lg">–ü—Ä–∏–º–µ—Ä</span>
                            </button>
                            <button class="subtitle-btn w-full p-4 bg-dark-800/50 rounded-xl border-2 border-white/10 text-left flex items-center justify-between" data-style="neon">
                                <div>
                                    <span class="text-sm text-white font-medium">–ù–µ–æ–Ω</span>
                                    <p class="text-xs text-dark-500">–°–≤–µ—Ç—è—â–∏–π—Å—è –≥–æ–ª—É–±–æ–π —ç—Ñ—Ñ–µ–∫—Ç</p>
                                </div>
                                <span class="text-cyan-400 text-lg" style="text-shadow: 0 0 10px cyan">–ü—Ä–∏–º–µ—Ä</span>
                            </button>
                        </div>
                    </div>

                    <!-- Art Style Gallery -->
                    <div>
                        <label class="block text-sm font-medium text-dark-300 mb-3">–í–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å (DALL-E)</label>
                        <p class="text-xs text-dark-500 mb-3">–í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                        <div class="art-styles-gallery flex gap-3 overflow-x-auto pb-3 scrollbar-thin" style="scroll-snap-type: x mandatory;">
                            <!-- Photo Realism (default) -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-brand-500 bg-brand-500/10 overflow-hidden transition-all hover:scale-105" data-style="photorealism" onclick="Faceless.setArtStyle('photorealism')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center">
                                    <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–§–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º</span>
                                </div>
                            </div>

                            <!-- Anime -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="anime" onclick="Faceless.setArtStyle('anime')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center">
                                    <span class="text-3xl">üéå</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–ê–Ω–∏–º–µ</span>
                                </div>
                            </div>

                            <!-- Studio Ghibli -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="ghibli" onclick="Faceless.setArtStyle('ghibli')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center">
                                    <span class="text-3xl">üèØ</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">Ghibli</span>
                                </div>
                            </div>

                            <!-- Disney Toon -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="disney" onclick="Faceless.setArtStyle('disney')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                                    <span class="text-3xl">üè∞</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">Disney</span>
                                </div>
                            </div>

                            <!-- Comic Book -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="comic" onclick="Faceless.setArtStyle('comic')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-red-500 to-yellow-500 flex items-center justify-center">
                                    <span class="text-3xl">üí•</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–ö–æ–º–∏–∫—Å</span>
                                </div>
                            </div>

                            <!-- Minecraft -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="minecraft" onclick="Faceless.setArtStyle('minecraft')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-green-600 to-emerald-800 flex items-center justify-center">
                                    <span class="text-3xl">‚õèÔ∏è</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">Minecraft</span>
                                </div>
                            </div>

                            <!-- LEGO -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="lego" onclick="Faceless.setArtStyle('lego')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-yellow-400 to-red-500 flex items-center justify-center">
                                    <span class="text-3xl">üß±</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">LEGO</span>
                                </div>
                            </div>

                            <!-- GTA V -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="gtav" onclick="Faceless.setArtStyle('gtav')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-orange-500 to-pink-600 flex items-center justify-center">
                                    <span class="text-3xl">üöó</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">GTA V</span>
                                </div>
                            </div>

                            <!-- Watercolor -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="watercolor" onclick="Faceless.setArtStyle('watercolor')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-cyan-300 to-blue-400 flex items-center justify-center">
                                    <span class="text-3xl">üé®</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–ê–∫–≤–∞—Ä–µ–ª—å</span>
                                </div>
                            </div>

                            <!-- Expressionism -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="expressionism" onclick="Faceless.setArtStyle('expressionism')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                                    <span class="text-3xl">üåÄ</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–≠–∫—Å–ø—Ä–µ—Å—Å–∏—è</span>
                                </div>
                            </div>

                            <!-- Charcoal -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="charcoal" onclick="Faceless.setArtStyle('charcoal')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-gray-600 to-gray-900 flex items-center justify-center">
                                    <span class="text-3xl">‚úèÔ∏è</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–£–≥–æ–ª—å</span>
                                </div>
                            </div>

                            <!-- Pixel Art -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="pixel" onclick="Faceless.setArtStyle('pixel')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                                    <span class="text-3xl">üëæ</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–ü–∏–∫—Å–µ–ª—å</span>
                                </div>
                            </div>

                            <!-- Creepy Toon -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="creepy" onclick="Faceless.setArtStyle('creepy')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-gray-800 to-red-900 flex items-center justify-center">
                                    <span class="text-3xl">üëª</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–ñ—É—Ç–∫–∏–π</span>
                                </div>
                            </div>

                            <!-- Children's Book -->
                            <div class="art-style-card flex-shrink-0 cursor-pointer rounded-xl border-2 border-white/10 overflow-hidden transition-all hover:scale-105 hover:border-brand-400" data-style="childrens" onclick="Faceless.setArtStyle('childrens')" style="width: 120px; scroll-snap-align: start;">
                                <div class="aspect-square bg-gradient-to-br from-pink-300 to-yellow-300 flex items-center justify-center">
                                    <span class="text-3xl">üìö</span>
                                </div>
                                <div class="p-2 text-center">
                                    <span class="text-xs font-medium text-white">–î–µ—Ç—Å–∫–∞—è</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-[10px] text-dark-600 mt-1">‚Üê –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π ‚Üí</p>
                    </div>

                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- –ë–õ–û–ö 3: –ê–£–î–ò–û -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-6"></div>

                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center">
                            <span class="text-white text-lg">üéôÔ∏è</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-white">–ê—É–¥–∏–æ</h2>
                            <p class="text-xs text-dark-400">–ì–æ–ª–æ—Å, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º—É–∑—ã–∫–∞</p>
                        </div>
                    </div>

                    <!-- –ì–æ–ª–æ—Å –∏ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-dark-300 mb-2">–ì–æ–ª–æ—Å –æ–∑–≤—É—á–∫–∏</label>
                            <select id="voice" class="w-full px-4 py-3 bg-dark-800/50 border border-white/10 rounded-xl text-white focus:outline-none focus:border-brand-500">
                                <option value="ru-RU-DmitryNeural">üé§ –î–º–∏—Ç—Ä–∏–π (–ú—É–∂, RU)</option>
                                <option value="ru-RU-SvetlanaNeural">üé§ –°–≤–µ—Ç–ª–∞–Ω–∞ (–ñ–µ–Ω, RU)</option>
                                <option value="en-US-GuyNeural">üé§ Guy (–ú—É–∂, EN)</option>
                                <option value="en-US-JennyNeural">üé§ Jenny (–ñ–µ–Ω, EN)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-dark-300 mb-2">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
                            <div class="flex gap-2">
                                <button type="button" class="duration-btn flex-1 px-3 py-3 bg-dark-800/50 border-2 border-white/10 rounded-xl text-white font-medium transition-all hover:border-brand-400" data-duration="30" onclick="Faceless.setDuration(30)">
                                    30—Å
                                </button>
                                <button type="button" class="duration-btn flex-1 px-3 py-3 bg-dark-800/50 border-2 border-brand-500 bg-brand-500/10 rounded-xl text-white font-medium transition-all" data-duration="60" onclick="Faceless.setDuration(60)">
                                    60—Å
                                </button>
                                <button type="button" class="duration-btn flex-1 px-3 py-3 bg-dark-800/50 border-2 border-white/10 rounded-xl text-white font-medium transition-all hover:border-brand-400" data-duration="90" onclick="Faceless.setDuration(90)">
                                    90—Å
                                </button>
                            </div>
                            <input type="hidden" id="duration" value="60">
                        </div>
                    </div>

                    <!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
                    <div class="flex items-center justify-between p-4 bg-dark-800/30 rounded-xl">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">üéµ</span>
                            <div>
                                <span class="text-sm text-white font-medium">–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞</span>
                                <p class="text-xs text-dark-500">Royalty-free –º—É–∑—ã–∫–∞</p>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="bg-music" checked class="sr-only peer">
                            <div class="w-11 h-6 bg-dark-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-600"></div>
                        </label>
                    </div>

                    <!-- Generate Button -->
                    <button onclick="Faceless.generate()" id="btn-generate"
                            class="w-full px-6 py-4 bg-gradient-to-r from-brand-600 to-indigo-600 hover:from-brand-500 hover:to-indigo-500 text-white font-bold text-lg rounded-xl transition-all flex items-center justify-center gap-3 mt-8">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                        –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ
                    </button>
                </div>
            </div>
        </div>

        <!-- Right: Preview & Status -->
        <div class="w-1/2 p-8 overflow-y-auto scrollbar-thin bg-dark-950/50">
            <!-- Current Job Progress -->
            <div id="job-progress" class="hidden max-w-md mx-auto">
                <div class="glass rounded-2xl p-8 text-center">
                    <!-- Progress Ring -->
                    <div class="relative w-32 h-32 mx-auto mb-6">
                        <svg class="progress-ring w-32 h-32">
                            <circle cx="64" cy="64" r="50" stroke="rgba(255,255,255,0.1)" stroke-width="8" fill="none"/>
                            <circle id="progress-circle" cx="64" cy="64" r="50" stroke="url(#gradient)" stroke-width="8" fill="none"/>
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="#a855f7"/>
                                    <stop offset="100%" stop-color="#6366f1"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="progress-percent" class="text-3xl font-bold text-white">0%</span>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold text-white mb-2">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ</h3>
                    <p id="progress-message" class="text-dark-400 mb-6">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>

                    <!-- Steps -->
                    <div class="flex justify-center gap-2 mb-6">
                        <div class="step-dot w-3 h-3 rounded-full bg-dark-600" data-step="script"></div>
                        <div class="step-dot w-3 h-3 rounded-full bg-dark-600" data-step="audio"></div>
                        <div class="step-dot w-3 h-3 rounded-full bg-dark-600" data-step="footage"></div>
                        <div class="step-dot w-3 h-3 rounded-full bg-dark-600" data-step="render"></div>
                    </div>

                    <button onclick="Faceless.cancel()" class="text-sm text-dark-400 hover:text-white transition-colors">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>

            <!-- Completed Video Preview -->
            <div id="video-result" class="hidden max-w-md mx-auto">
                <div class="glass rounded-2xl overflow-hidden">
                    <div class="aspect-[9/16] bg-black relative">
                        <video id="result-video" class="w-full h-full object-contain" controls></video>
                    </div>
                    <div class="p-4 space-y-3">
                        <h3 id="result-title" class="text-lg font-bold text-white">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</h3>
                        <div class="flex gap-3">
                            <button onclick="Faceless.download()" class="flex-1 px-4 py-3 bg-gradient-to-r from-brand-600 to-indigo-600 text-white font-semibold rounded-xl flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                –°–∫–∞—á–∞—Ç—å MP4
                            </button>
                            <button onclick="Faceless.openEditor()" class="px-4 py-3 bg-white/5 hover:bg-white/10 text-white font-medium rounded-xl border border-white/10">
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="max-w-md mx-auto text-center py-16">
                <div class="w-24 h-24 bg-dark-800/50 rounded-3xl flex items-center justify-center mx-auto mb-6">
                    <svg class="w-12 h-12 text-dark-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ</h3>
                <p class="text-dark-400 mb-8">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å¬ª, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ</p>

                <div class="bg-dark-800/30 rounded-xl p-4 text-left">
                    <h4 class="text-sm font-semibold text-white mb-3">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h4>
                    <div class="space-y-2 text-sm text-dark-400">
                        <div class="flex items-center gap-2">
                            <span class="w-5 h-5 bg-brand-500/20 text-brand-400 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                            <span>–ò–ò —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-5 h-5 bg-brand-500/20 text-brand-400 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                            <span>–û–∑–≤—É—á–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-5 h-5 bg-brand-500/20 text-brand-400 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                            <span>–í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–¥ —Å—Ü–µ–Ω–∞—Ä–∏–π</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-5 h-5 bg-brand-500/20 text-brand-400 rounded-full flex items-center justify-center text-xs font-bold">4</span>
                            <span>–§–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å —Å—É–±—Ç–∏—Ç—Ä–∞–º–∏</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Jobs -->
            <div id="recent-jobs" class="max-w-md mx-auto mt-8">
                <h3 class="text-sm font-semibold text-dark-400 uppercase tracking-wider mb-4">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h3>
                <div id="jobs-list" class="space-y-3">
                    <!-- Jobs will be rendered here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const Faceless = {
    currentJobId: null,
    pollInterval: null,
    settings: {
        format: '9:16',
        subtitleStyle: 'hormozi',
        artStyle: 'photorealism',
        imageProvider: 'kie',  // Only Kie.ai (Nano Banana) is supported
        ideaMode: 'expand'
    },

    setImageProvider(provider) {
        // Only Kie.ai is supported - ignore parameter
        this.settings.imageProvider = 'kie';
    },

    setIdeaMode(mode) {
        this.settings.ideaMode = mode;
        document.getElementById('idea_mode').value = mode;
        document.querySelectorAll('.idea-mode-btn').forEach(btn => {
            if (btn.dataset.mode === mode) {
                btn.classList.add('border-brand-500', 'bg-brand-500/10');
                btn.classList.remove('border-white/10');
            } else {
                btn.classList.remove('border-brand-500', 'bg-brand-500/10');
                btn.classList.add('border-white/10');
            }
        });
    },

    toggleCustomIdea() {
        const section = document.getElementById('custom-idea-section');
        const toggleText = document.getElementById('toggle-idea-text');
        const toggleIcon = document.getElementById('toggle-idea-icon');
        if (section.classList.contains('hidden')) {
            section.classList.remove('hidden');
            toggleText.textContent = '–°–∫—Ä—ã—Ç—å';
            toggleIcon.style.transform = 'rotate(180deg)';
        } else {
            section.classList.add('hidden');
            toggleText.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            toggleIcon.style.transform = 'rotate(0deg)';
            document.getElementById('custom_idea').value = '';
        }
    },

    setArtStyle(style) {
        this.settings.artStyle = style;
        document.querySelectorAll('.art-style-card').forEach(card => {
            if (card.dataset.style === style) {
                card.classList.add('border-brand-500', 'bg-brand-500/10');
                card.classList.remove('border-white/10');
            } else {
                card.classList.remove('border-brand-500', 'bg-brand-500/10');
                card.classList.add('border-white/10');
            }
        });
    },

    setDuration(seconds) {
        document.getElementById('duration').value = seconds;
        document.querySelectorAll('.duration-btn').forEach(btn => {
            const btnDuration = parseInt(btn.dataset.duration);
            if (btnDuration === seconds) {
                btn.classList.add('border-brand-500', 'bg-brand-500/10');
                btn.classList.remove('border-white/10');
            } else {
                btn.classList.remove('border-brand-500', 'bg-brand-500/10');
                btn.classList.add('border-white/10');
            }
        });
    },

    async generate() {
        const topic = document.getElementById('topic').value.trim();
        if (!topic) {
            App.showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É', 'error');
            return;
        }

        // Get custom idea if provided
        const customIdea = document.getElementById('custom_idea')?.value?.trim() || null;
        const ideaMode = document.getElementById('idea_mode')?.value || 'expand';

        const params = {
            topic,
            style: document.getElementById('style').value,
            language: document.getElementById('language').value,
            voice: document.getElementById('voice').value,
            duration: parseInt(document.getElementById('duration').value),
            format: this.settings.format,
            subtitle_style: this.settings.subtitleStyle,
            art_style: this.settings.artStyle,
            background_music: document.getElementById('bg-music').checked,
            music_volume: 0.2,
            image_provider: this.settings.imageProvider
        };

        // Add custom idea if provided
        if (customIdea) {
            params.custom_idea = customIdea;
            params.idea_mode = ideaMode;
        }

        // Show progress
        document.getElementById('empty-state').classList.add('hidden');
        document.getElementById('video-result').classList.add('hidden');
        document.getElementById('job-progress').classList.remove('hidden');

        try {
            const response = await fetch('/api/faceless/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params)
            });

            const result = await response.json();
            if (!response.ok) {
                // Handle error - detail can be string or object
                let errorMsg = '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏';
                if (result.detail) {
                    if (typeof result.detail === 'string') {
                        errorMsg = result.detail;
                    } else if (result.detail.reason) {
                        errorMsg = result.detail.reason;
                    } else if (result.detail.error) {
                        errorMsg = result.detail.error;
                    }
                }
                throw new Error(errorMsg);
            }

            this.currentJobId = result.job_id;
            this.startPolling();

        } catch (e) {
            App.showToast('–û—à–∏–±–∫–∞: ' + e.message, 'error');
            this.showEmptyState();
        }
    },

    startPolling() {
        if (this.pollInterval) clearInterval(this.pollInterval);

        this.pollInterval = setInterval(async () => {
            try {
                const response = await fetch(`/api/faceless/status/${this.currentJobId}`);
                const status = await response.json();

                this.updateProgress(status);

                if (status.status === 'completed') {
                    clearInterval(this.pollInterval);
                    this.showResult(status);
                } else if (status.status === 'failed') {
                    clearInterval(this.pollInterval);
                    App.showToast('–û—à–∏–±–∫–∞: ' + (status.error || '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å'), 'error');
                    this.showEmptyState();
                }
            } catch (e) {
                console.error('Polling error:', e);
            }
        }, 2000);
    },

    updateProgress(status) {
        const percent = Math.round(status.progress);
        document.getElementById('progress-percent').textContent = `${percent}%`;
        document.getElementById('progress-message').textContent = status.progress_message;

        // Update progress ring
        const circle = document.getElementById('progress-circle');
        const circumference = 314; // 2 * PI * 50
        const offset = circumference - (percent / 100) * circumference;
        circle.style.strokeDashoffset = offset;

        // Update step dots
        const dots = document.querySelectorAll('.step-dot');
        if (status.status === 'generating_script' || percent >= 20) {
            dots[0].classList.add('active');
        }
        if (status.status === 'generating_audio' || percent >= 40) {
            dots[0].classList.remove('active');
            dots[0].classList.add('completed');
            dots[1].classList.add('active');
        }
        if (status.status === 'downloading_footage' || percent >= 70) {
            dots[1].classList.remove('active');
            dots[1].classList.add('completed');
            dots[2].classList.add('active');
        }
        if (status.status === 'rendering' || percent >= 90) {
            dots[2].classList.remove('active');
            dots[2].classList.add('completed');
            dots[3].classList.add('active');
        }
    },

    showResult(status) {
        document.getElementById('job-progress').classList.add('hidden');
        document.getElementById('video-result').classList.remove('hidden');

        const video = document.getElementById('result-video');
        video.src = `/api/faceless/download/${this.currentJobId}`;

        document.getElementById('result-title').textContent = status.script?.title || status.topic;

        App.showToast('–í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!');
        this.loadRecentJobs();
    },

    showEmptyState() {
        document.getElementById('job-progress').classList.add('hidden');
        document.getElementById('video-result').classList.add('hidden');
        document.getElementById('empty-state').classList.remove('hidden');
    },

    cancel() {
        if (this.pollInterval) clearInterval(this.pollInterval);
        this.showEmptyState();
    },

    download() {
        if (this.currentJobId) {
            window.open(`/api/faceless/download/${this.currentJobId}`, '_blank');
        }
    },

    openEditor() {
        if (this.currentJobId) {
            window.location.href = `/app/pro-editor?job_id=${this.currentJobId}`;
        }
    },

    async loadRecentJobs() {
        try {
            const response = await fetch('/api/faceless/recent?limit=10');
            const data = await response.json();
            const jobs = data.jobs || [];

            const list = document.getElementById('jobs-list');
            if (!jobs.length) {
                list.innerHTML = '<p class="text-sm text-dark-500">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</p>';
                return;
            }

            list.innerHTML = jobs.map(job => `
                <div class="job-card glass rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-white truncate flex-1 mr-2">${job.topic}</span>
                        <span class="px-2 py-0.5 rounded text-xs ${this.getStatusClass(job.status)}">${job.status}</span>
                    </div>
                    <div class="flex items-center justify-between text-xs text-dark-500 mb-3">
                        <span>${this.formatDate(job.created_at)}</span>
                        ${job.status === 'completed' ? '<span class="text-green-400">–ì–æ—Ç–æ–≤–æ</span>' : ''}
                    </div>
                    ${job.status === 'completed' ? `
                        <div class="flex gap-2">
                            <button onclick="Faceless.loadJob('${job.job_id}')" class="flex-1 px-3 py-1.5 bg-white/5 hover:bg-white/10 text-white text-xs font-medium rounded-lg flex items-center justify-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                –ü—Ä–æ—Å–º–æ—Ç—Ä
                            </button>
                            <button onclick="Faceless.editJob('${job.job_id}')" class="flex-1 px-3 py-1.5 bg-brand-600/20 hover:bg-brand-600/30 text-brand-400 text-xs font-medium rounded-lg flex items-center justify-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button onclick="Faceless.downloadJob('${job.job_id}')" class="px-3 py-1.5 bg-green-600/20 hover:bg-green-600/30 text-green-400 text-xs font-medium rounded-lg flex items-center justify-center">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');

        } catch (e) {
            console.error('Failed to load jobs:', e);
        }
    },

    getStatusClass(status) {
        switch (status) {
            case 'completed': return 'bg-green-500/20 text-green-400';
            case 'failed': return 'bg-red-500/20 text-red-400';
            case 'pending': return 'bg-yellow-500/20 text-yellow-400';
            default: return 'bg-brand-500/20 text-brand-400';
        }
    },

    formatDate(isoString) {
        const date = new Date(isoString);
        return date.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    },

    loadJob(jobId) {
        this.currentJobId = jobId;
        document.getElementById('empty-state').classList.add('hidden');
        document.getElementById('job-progress').classList.add('hidden');
        document.getElementById('video-result').classList.remove('hidden');

        const video = document.getElementById('result-video');
        video.src = `/api/faceless/download/${jobId}`;
    },

    // Open the editor with this job's segments
    editJob(jobId) {
        window.location.href = `/app/pro-editor?job_id=${jobId}`;
    },

    // Download the video file
    downloadJob(jobId) {
        window.open(`/api/faceless/download/${jobId}`, '_blank');
    }
};

// Format buttons
document.querySelectorAll('.format-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.format-btn').forEach(b => {
            b.classList.remove('border-brand-500', 'bg-brand-500/10');
            b.classList.add('border-white/10');
            b.querySelector('div').classList.remove('border-brand-400');
            b.querySelector('div').classList.add('border-dark-400');
            b.querySelectorAll('span').forEach(s => {
                if (!s.classList.contains('text-[10px]')) {
                    s.classList.remove('text-white');
                    s.classList.add('text-dark-300');
                }
            });
        });

        btn.classList.add('border-brand-500', 'bg-brand-500/10');
        btn.classList.remove('border-white/10');
        btn.querySelector('div').classList.add('border-brand-400');
        btn.querySelector('div').classList.remove('border-dark-400');
        btn.querySelectorAll('span').forEach(s => {
            if (!s.classList.contains('text-[10px]')) {
                s.classList.add('text-white');
                s.classList.remove('text-dark-300');
            }
        });

        Faceless.settings.format = btn.dataset.format;
    });
});

// Subtitle style buttons
document.querySelectorAll('.subtitle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.subtitle-btn').forEach(b => {
            b.classList.remove('border-brand-500', 'bg-brand-500/10');
            b.classList.add('border-white/10');
        });

        btn.classList.add('border-brand-500', 'bg-brand-500/10');
        btn.classList.remove('border-white/10');

        Faceless.settings.subtitleStyle = btn.dataset.style;
    });
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    Faceless.loadRecentJobs();
});
</script>
{% endblock %}
