# üé¨ Visual Variety System - 30/70 Rule

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

**–î–æ:** 90% –∫–∞–¥—Ä–æ–≤ - –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –ª–∏—Ü–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–ø–æ—Ä—Ç—Ä–µ—Ç—ã). –í–∏–¥–µ–æ —Å–∫—É—á–Ω–æ–µ –∏ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–µ.

**–ü–æ—Å–ª–µ:** –î–∏–Ω–∞–º–∏—á–Ω–æ–µ, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º –ø–ª–∞–Ω–æ–≤: –ø–µ–π–∑–∞–∂–∏, –¥–µ—Ç–∞–ª–∏, –¥–µ–π—Å—Ç–≤–∏—è, –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞.

---

## üìä –ü—Ä–∞–≤–∏–ª–æ 30/70

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤:
- **MAX 30-40%** - –ü–µ—Ä—Å–æ–Ω–∞–∂ (–ø–æ—Ä—Ç—Ä–µ—Ç—ã, —Å—Ä–µ–¥–Ω–∏–µ –ø–ª–∞–Ω—ã —Å –ª–∏—Ü–æ–º)
- **MIN 60-70%** - –û–∫—Ä—É–∂–µ–Ω–∏–µ/–î–µ–π—Å—Ç–≤–∏–µ/–î–µ—Ç–∞–ª–∏ (–ë–ï–ó –ª–∏—Ü!)

### –¢–∏–ø—ã –ø–ª–∞–Ω–æ–≤:

#### Environment Shots (60-70%):
1. **WIDE SHOT** - –ü–µ–π–∑–∞–∂–∏, –∑–¥–∞–Ω–∏—è, –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞
2. **AERIAL SHOT** - –í–∏–¥ —Å –≤—ã—Å–æ—Ç—ã –ø—Ç–∏—á—å–µ–≥–æ –ø–æ–ª—ë—Ç–∞
3. **DETAIL/CLOSE-UP** - –ü—Ä–µ–¥–º–µ—Ç—ã, —Ä—É–∫–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
4. **POV SHOT** - –í–∏–¥ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞

#### Character Shots (30-40% MAX):
5. **MEDIUM SHOT** - –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (—ç–∫–æ–Ω–æ–º–Ω–æ!)
6. **PORTRAIT** - –õ–∏—Ü–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–û–ß–ï–ù–¨ —ç–∫–æ–Ω–æ–º–Ω–æ!)

---

## üéØ –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–ª–∞–Ω–∞

### –ü—Ä–∞–≤–∏–ª–æ —Å–≤—è–∑–∏ —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º:

–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞ –≥–æ–≤–æ—Ä–∏—Ç—Å—è –ø—Ä–æ:
- **"–±–∏—Ç–≤–∞", "–≤–æ–π–Ω–∞"** ‚Üí **WIDE SHOT** –ø–æ–ª—è –±–æ—è (–ù–ï –ø–æ—Ä—Ç—Ä–µ—Ç –≤–æ–∏–Ω–∞!)
- **"–∑–æ–ª–æ—Ç–æ", "—Å–æ–∫—Ä–æ–≤–∏—â–∞"** ‚Üí **DETAIL SHOT** –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç
- **"–∑–¥–∞–Ω–∏–µ", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"** ‚Üí **AERIAL/WIDE** –∑–¥–∞–Ω–∏–π
- **"–ø–µ–π–∑–∞–∂", "—Å—Ç–µ–ø—å"** ‚Üí **WIDE SHOT** –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞
- **"–æ—Ä—É–∂–∏–µ", "–∞—Ä—Ç–µ—Ñ–∞–∫—Ç"** ‚Üí **DETAIL SHOT** –ø—Ä–µ–¥–º–µ—Ç–∞
- **"—Ü–µ—Ä–µ–º–æ–Ω–∏—è", "—Ä–∏—Ç—É–∞–ª"** ‚Üí **WIDE SHOT** —Å—Ü–µ–Ω—ã —Å —Ç–æ–ª–ø–æ–π

### –ü—Ä–∞–≤–∏–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

‚ùå **–ó–ê–ü–†–ï–©–ï–ù–û:** 3+ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–¥—Ä—è–¥
‚úÖ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** –ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ - –µ—Å–ª–∏ 2 –∫–∞–¥—Ä–∞ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º, 3-–π –û–ë–Ø–ó–ê–ù –±—ã—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. `ShotType` (enum)
```python
- WIDE = "wide_shot"
- MEDIUM = "medium_shot"
- CLOSE_UP = "close_up"
- PORTRAIT = "portrait"
- POV = "pov_shot"
- DETAIL = "detail_shot"
- AERIAL = "aerial_shot"
```

#### 2. `VisualVarietyTracker`
–°–ª–µ–¥–∏—Ç –∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–ª–∞–Ω–æ–≤:
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞–¥—Ä—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç 30-40%
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (max 2 –ø–æ–¥—Ä—è–¥)

#### 3. `_enforce_visual_variety()` –º–µ—Ç–æ–¥
–ì–ª–∞–≤–Ω—ã–π enforcement –º–µ—Ç–æ–¥:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ action keywords
3. –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç = –¥–µ–π—Å—Ç–≤–∏–µ, –∞ –ø—Ä–æ–º–ø—Ç = –ø–æ—Ä—Ç—Ä–µ—Ç ‚Üí **–ö–û–ù–í–ï–†–¢–ò–†–£–ï–¢**
4. –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π ‚Üí **–ö–û–ù–í–ï–†–¢–ò–†–£–ï–¢**

#### 4. `_convert_to_environment_shot()` –º–µ—Ç–æ–¥
–£–º–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞:
```python
"battle" in text ‚Üí "wide shot, battlefield scene, armies clashing..."
"gold" in text ‚Üí "extreme close-up, golden coins, treasures..."
"landscape" in text ‚Üí "aerial shot, vast territory, epic scale..."
```

---

## üìã –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π System Prompt

–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª **"üé¨ 30/70 RULE"** —Å:
- –ó–∞–ø—Ä–µ—Ç–æ–º –Ω–∞ "talking head" –≤–∏–¥–µ–æ
- Mandatory —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–ª–∞–Ω–æ–≤
- –ü—Ä–∏–º–µ—Ä–æ–º GOOD (25% –ø–µ—Ä—Å–æ–Ω–∞–∂, 75% –æ–∫—Ä—É–∂–µ–Ω–∏–µ)
- –ü—Ä–∏–º–µ—Ä–æ–º BAD (100% –ø–æ—Ä—Ç—Ä–µ—Ç—ã - REJECTED!)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç: "History of Kazakh Khanate with battles and treasures"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Character shots: 0/6 (0.0%)
Environment shots: 6/6 (100.0%)
Max consecutive character shots: 1
```

**–ü—Ä–∏–º–µ—Ä—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤:**
1. Wide shot - Central Asian steppe landscape
2. Aerial shot - nomadic camps from above
3. Wide shot - 15th century battlefield
4. Detail shot - Battle scene
5. Wide shot - territory panorama
6. **Extreme close-up - golden coins and treasures** ‚ú®

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **EXCELLENT - Dynamic and interesting!**

---

## üé¨ –î–æ vs –ü–æ—Å–ª–µ

### –î–æ (—Å–∫—É—á–Ω–æ):
```
Segment 1: Portrait - Warrior face
Segment 2: Portrait - Same warrior
Segment 3: Medium shot - Warrior talking
Segment 4: Portrait - Warrior closeup
Segment 5: Portrait - Warrior again
Segment 6: Portrait - Still warrior
...
Result: 100% character shots ‚ùå BORING!
```

### –ü–æ—Å–ª–µ (–¥–∏–Ω–∞–º–∏—á–Ω–æ):
```
Segment 1: Wide shot - Epic steppe landscape
Segment 2: Aerial - Territory from above
Segment 3: Detail - Traditional weapons
Segment 4: Wide shot - Battle scene
Segment 5: Close-up - Gold treasures
Segment 6: Medium - Warrior on horse (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂!)
...
Result: 17% character, 83% environment ‚úÖ DYNAMIC!
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

–°–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
1. ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
2. ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç–∏–ø –ø–ª–∞–Ω–∞
3. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—Ä–µ—Ç—ã –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. ‚úÖ –°–ª–µ–¥–∏—Ç –∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º 30/70
5. ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç 3+ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤

**–ü—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–≤–∞–π –≤–∏–¥–µ–æ –∫–∞–∫ –æ–±—ã—á–Ω–æ** —á–µ—Ä–µ–∑ `/app/faceless` - –∏ –ø–æ–ª—É—á–∏—à—å –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üé•

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/services/agents/visual_director.py`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª–∞—Å—Å—ã: `ShotType`, `VisualVarietyTracker`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã: `_enforce_visual_variety()`, `_convert_to_environment_shot()`
  - –û–±–Ω–æ–≤–ª—ë–Ω `SEGMENTATION_SYSTEM_PROMPT_TEMPLATE` —Å –ø—Ä–∞–≤–∏–ª–æ–º 30/70
  - Enforcement –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ–±–∞ –º–µ—Ç–æ–¥–∞: `segment_story()` –∏ `segment_story_with_visual_bible()`

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ò–õ–õ–Æ–°–¢–†–ò–†–£–ï–¢ –¥–µ–π—Å—Ç–≤–∏–µ**, –∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–≥–æ–≤–æ—Ä—è—â—É—é –≥–æ–ª–æ–≤—É"
2. **–¢–µ–∫—Å—Ç –ø—Ä–æ –±–∏—Ç–≤—É** = –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∏—Ç–≤—ã, –ù–ï –ø–æ—Ä—Ç—Ä–µ—Ç –≤–æ–∏–Ω–∞
3. **–¢–µ–∫—Å—Ç –ø—Ä–æ –∑–æ–ª–æ—Ç–æ** = –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω –∑–æ–ª–æ—Ç–∞, –ù–ï —á–µ–ª–æ–≤–µ–∫ —Å –∑–æ–ª–æ—Ç–æ–º
4. **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–ª–∞–Ω–æ–≤** = –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ
5. **30/70 –ø—Ä–∞–≤–∏–ª–æ** = –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º

---

## ‚ú® –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç **–∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–µ, –¥–∏–Ω–∞–º–∏—á–Ω—ã–µ –≤–∏–¥–µ–æ** —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ä–µ–∂–∏—Å—Å—É—Ä–æ–π –ø–ª–∞–Ω–æ–≤, –∞ –Ω–µ —Å–∫—É—á–Ω—ã–µ "–≤–∏–¥–µ–æ-–º–æ–Ω–æ–ª–æ–≥–∏" —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –ª–∏—Ü–æ–º! üé¨‚ú®
